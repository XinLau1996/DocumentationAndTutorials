# Contos7环境下MySql-5.7.27的安装配置 #
### 注意看我的标题！！！！我这是针对5.7.27版本 ###
## 一、检查本地是否安装 ##
### 1、检查 ###
    rpm -qa | grep mysql
### 2、卸载 ###
    rpm -e 已经存在的MySQL全名
## 二、下载 ##
### 1、wget方式下载 ###
    wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz
##### 若报错：`-bash: wget: command not found` 表明没有安装wget，需要执行如下命令安装： #####
    yum -y install wget
## 三、解压操作文件 ##
### 1、解压 ###
    tar -zxvf mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz -C /usr/local/
### 2、修改名称 ###
    mv mysql-5.7.27-linux-glibc2.12-x86_64 /usr/local/mysql-5.7.27
## 四、配置启动文件 ###
### 1、切换到 mysql-5.7.27 的support-files目录下 ###
    cd mysql-5.7.27/support-files/
#### 修改 `mysqld_multi.server` 文件第17-18行
```
basedir=/usr/local/mysql-5.7.27
bindir=/usr/local/mysql-5.7.27/bin
```
### 2、复制 my-default.cnf 到 /etc/my.cnf（MySQL启动时自动读取）
#### （1）、切换目录	
	cd /usr/local/mysql-5.7.27/
#### （2）、复制
    cp my-default.cnf /etc/my.cnf
##### 注意： 如果你在安装时Linux虚拟机时同时安装了默认的mysql，此时操作以上步骤，终端将会提示你文件已存在是否覆盖，输入yes覆盖即可。 #####
	cp: overwrite ‘/etc/my.cnf’? yes
### 3、配置my.cnf文件 ###
    vim /etc/my.cnf
##### 参考：（注意修改：`basedir` `datadir` `server-id` `log-bin` `log-error` `binlog-do-db`） #####
###### PS：修改配置文件前手动在安装路径下新建 `logs` 文件夹，在其下分别创建两个名为 `binlog` `errlog` 的文件夹 ######
	# For advice on how to change settings please see
	# http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html
	# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
	# *** default location during install, and will be replaced if you
	# *** upgrade to a newer version of MySQL.
	
	[mysqld]
	
	# Remove leading # and set to the amount of RAM for the most important data
	# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
	# innodb_buffer_pool_size = 128M
	
	# Remove leading # to turn on a very important data integrity option: logging
	# changes to the binary log between backups.
	# log_bin
	
	# These are commonly set, remove the # and set as required.
	# 配置MYSQL安装目录
	basedir = /usr/local/mysql-5.7.27
	# 配置MYSQL存储数据DATA目录
	datadir = /usr/local/mysql-5.7.27/data
	# 配置端口
	port = 3306
	# 配置允许最大连接数
	#max_connections = 100
	# 配置允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统
	max_connect_errors = 10
	# 配置mysql在关闭一个非交互的连接之前所要等待的秒数，其取值范围为1-2147483(Windows)，1-31536000(linux)，默认值28800。
	#wait_timeout = 31536000
	# 配置mysql在关闭一个交互的连接之前所要等待的秒数(交互连接如mysql gui tool中的连接)，其取值范围随wait_timeout变动，默认值28800。
	#interactive_timeout = 31536000
	# 添加默认数据引擎项
	default-storage-engine = InnoDB
	# 添加字符集参数
	character-set-server = utf8
	# 添加不区分表/字段大小写项
	lower_case_table_names = 1
	
	# 服务器标志号，注意在配置文件中不能出现多个这样的标识，如果出现多个的话mysql以第一个为准，一组主从中此标识号不能重复。
	server-id = 1
	# 开启bin-log，并指定文件目录和文件名前缀。
	log-bin = /usr/local/mysql-5.7.27/logs/binlog/bin-log
	# 错误日志存放路径
	log-error = /usr/local/mysql-5.7.27/logs/errlog/master-error.log
	# 每个bin-log最大大小，当此大小等于500M时会自动生成一个新的日志文件。一条记录不会写在2个日志文件中，所以有时日志文件会超过此大小。
	max_binlog_size = 500M
	# 日志缓存大小
	binlog_cache_size = 128K
	# 需要同步的数据库名字，如果是多个，就以此格式在写一行即可。
	#binlog-do-db = database_test
	# 不需要同步的数据库名字，如果是多个，就以此格式在写一行即可。（binlog-do-db,binlog-ignore-db 为互斥关系，只需设置其中一项即可）
	binlog-ignore-db = mysql,information_schema,performance_schema,sys
	# 当Slave从Master数据库读取日志时更新新写入日志中，如果只启动log-bin 而没有启动log-slave-updates则Slave（从）只记录针对自己数据库操作的更新。
	log-slave-updates
	# 设置bin-log日志文件格式为：MIXED，可以防止主键重复。
	binlog_format = "MIXED"
	# 解除bin-log限制存储函数的创建、修改、调用
	#log_bin_trust_function_creators = 1
	
	sql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES
	
	# 绕过所有的权限验证
	#skip_grant_tables
	
	[mysql]
	# 添加默认字符集参数
	default-character-set = utf8
	# 修改MYSQL端口号，默认为3306，建议不要用默认的，请配置为其他端口号，例如：3369、6033等
	port = 3306
	
	[client]
	# 添加默认字符集参数
	default-character-set = utf8
	# 修改MYSQL端口号，默认为3306，建议不要用默认的，请配置为其他端口号，例如：3369、6033等
	port = 3306
	
	# Remove leading # to set options mainly useful for reporting servers.
	# The server defaults are faster for transactions and fast SELECTs.
	# Adjust sizes as needed, experiment to find the optimal values.
	# join_buffer_size = 128M
	# sort_buffer_size = 2M
	# read_rnd_buffer_size = 2M

### 4、将当前文件夹授权给mysql ###
#### 创建mysql组 ####
	groupadd mysql
#### 创建mysql用户添加到mysql组 ####
	useradd -g mysql mysql
#### 授权 ####
    chown -R mysql:mysql /usr/local/mysql-5.7.27/
## 五、初始化 ##
### 1、进入bin目录 ###
    cd /usr/local/mysql-5.7.27/bin/
### 2、初始化数据库 ###
    ./mysqld --initialize --user=mysql --basedir=/usr/local/mysql-5.7.27 --datadir=/usr/local/mysql-5.7.27/data
### 3、安全启动 ###
    ./mysqld_safe --user=mysql &
### 4、验证是否安全启动 ###
    ps -ef | grep mysql
## 六、登录 ##
### 1、进入bin目录 ###
    cd /usr/local/mysql-5.7.27/bin/
### 2、登录 ###
    ./mysql -u root -p	
##### PS:密码在 `/usr/local/mysql-5.7.27/logs/errlog/master-error.log` 大约八行左右

#### 报错
	./mysql: error while loading shared libraries: libncurses.so.5: cannot open shared object file: No such file or directory
	
##### 解决
	yum install libncurses*

### 3、重置密码 ###
     set password=password("root");
### 4、设置远程登录权限 ###
    grant all privileges on *.* to 'root'@'%' identified by 'root';
### 5、立即生效 ###
    flush privileges;
### 6、退出登录 ###
    quit
##### 或者 #####
	exit
## 六、开机服务启动设置 ##
`注意mysql.server文件中66行-73行的数据库安装路径`
### 1、把support-files/mysql.server 拷贝为/etc/init.d/mysql-5.7.27 ###
	cp -a /usr/local/mysql-5.7.27/support-files/mysql.server /etc/init.d/mysql-5.7.27
### 2、查看mysql-5.7.27服务是否在服务配置中 ###
	chkconfig --list mysql-5.7.27
### 3、若没有注意看提示语，手动把把mysql-5.7.27注册为开机启动的服务
	chkconfig --add mysql-5.7.27
### 4、查看mysql-5.7.27服务是否配置成功 ###
	chkconfig --list mysql-5.7.27
##### 成功如下： #####
	Note: This output shows SysV services only and does not include native
      systemd services. SysV configuration data might be overridden by native
      systemd configuration.
 
      If you want to list systemd services use 'systemctl list-unit-files'.
      To see services enabled on particular target use
      'systemctl list-dependencies [target]'.
 
	mysql           0:off   1:off   2:on    3:on    4:on    5:on    6:off
##### PS：若在Ubuntu中,则需要安排软件支持chkconfig #####
###### 1、安装 ######
	sudo apt install sysv-rc-conf
	sudo cp /usr/sbin/sysv-rc-conf /usr/sbin/chkconfig
### 5、快捷启动与关闭 ###
##### 启动 #####
	service mysql-5.7.27 start
##### 关闭 #####
	service mysql-5.7.27 stop
##### 重启 #####
	service mysql-5.7.27 restart
##### 查看状态 #####
	service mysql-5.7.27 status
## 七、创建快捷方式 ##
### 服务启动后，直接运行mysql -u root -p即可登录，不需要进入到对应的目录 ###
	ln -s /usr/local/mysql-5.7.27/bin/mysql /usr/bin
### 重启计算机 ###
	shutdown -r now
	
## 八、测试完整性 ##
### 1、登录 ###
	mysql -h [host] -u [username] -p [password]
<del>mysql -u root -p</del>
	
## 九、问题解决 ##
### 1、 `ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)` 忘记密码 ###
#### 解决 ####
	1、修改 /etc/my.cnf 文件 第63行，绕过所有的权限验证
	2、还没写完......
### 2、防火墙端口开放 ###
#### 解决 ####
##### 1、查看防火墙状态 #####
	firewall-cmd --state
##### 2、关闭防火墙 #####
	systemctl stop firewalld.service
##### 3、禁止防火墙开机自启 #####
	systemctl disable firewalld.service
##### 4、开启防火墙 #####
	systemctl start firewalld.service
##### 5、Add 添加开放端口 #####
	firewall-cmd --permanent --zone=public --add-port=3306/tcp
##### 6、Reload 重新加载 #####
	firewall-cmd --reload
##### 7、检查是否生效 ######
	firewall-cmd --zone=public --query-port=3306/tcp

### 3、`temporary failure in name resolution` 问题，或者是服务正常启动，访问效率特别慢（适用于MySQL\MyCat\TomCat） ###
#### 解决（DNS的问题） ####
##### 1、查看主机名称 #####
	hostname
##### 2、配置 `vim /etc/hosts`	#####
	127.0.0.1   主机名称 localhost localhost.localdomain localhost4 localhost4.localdomain4
	::1         localhost localhost.localdomain localhost6 localhost6.localdomain6